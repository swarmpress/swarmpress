---
/**
 * Embed Block Component
 * Renders embedded content (YouTube, Twitter, etc.)
 */
export interface Props {
  url: string
  type: 'youtube' | 'vimeo' | 'twitter' | 'iframe'
  caption?: string
  className?: string
}

const { url, type, caption, className = '' } = Astro.props

// Extract video ID from YouTube URL
function getYouTubeId(url: string): string | null {
  const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/)
  return match ? match[1] : null
}

// Extract video ID from Vimeo URL
function getVimeoId(url: string): string | null {
  const match = url.match(/vimeo\.com\/(\d+)/)
  return match ? match[1] : null
}

let embedHtml = ''

if (type === 'youtube') {
  const videoId = getYouTubeId(url)
  if (videoId) {
    embedHtml = `<iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`
  }
} else if (type === 'vimeo') {
  const videoId = getVimeoId(url)
  if (videoId) {
    embedHtml = `<iframe src="https://player.vimeo.com/video/${videoId}" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`
  }
} else if (type === 'twitter') {
  // For Twitter, we'd need to use their oEmbed API or widget
  // For now, just link to the tweet
  embedHtml = `<a href="${url}" target="_blank" rel="noopener noreferrer">View Tweet</a>`
} else if (type === 'iframe') {
  embedHtml = `<iframe src="${url}" frameborder="0" allowfullscreen></iframe>`
}
---

<div class={`block-embed embed-${type} ${className}`}>
  <div class="embed-container" set:html={embedHtml} />
  {caption && <p class="embed-caption">{caption}</p>}
</div>

<style>
  .block-embed {
    margin: 2rem 0;
  }

  .embed-container {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
    border-radius: 8px;
    background-color: var(--color-bg-alt);
  }

  .embed-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .embed-caption {
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: var(--color-text-light);
    text-align: center;
    font-style: italic;
  }
</style>
