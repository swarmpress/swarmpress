---
/**
 * Language-specific homepage
 * Loads content from cinqueterre.travel/content/pages/index.json
 */
import Layout from '../../layouts/Layout.astro';
import ContentRenderer from '../../ContentRenderer.astro';
import Footer from '../../components/Footer';
import { CONTENT_DIR } from '../../config/content-paths';
import fs from 'fs';
import path from 'path';

export async function getStaticPaths() {
  // Content directory path - resolved from environment or relative paths

  // Supported languages
  const SUPPORTED_LANGS = ['en', 'de', 'fr', 'it'];

  const indexPath = path.join(CONTENT_DIR, 'index.json');

  if (!fs.existsSync(indexPath)) {
    return SUPPORTED_LANGS.map(lang => ({
      params: { lang },
      props: { pageData: null }
    }));
  }

  const content = JSON.parse(fs.readFileSync(indexPath, 'utf-8'));

  return SUPPORTED_LANGS.map(lang => ({
    params: { lang },
    props: {
      pageData: {
        ...content,
        currentLang: lang,
        title: content.title?.[lang] || content.title?.en || content.title,
        seo: {
          title: content.seo?.title?.[lang] || content.seo?.title?.en,
          description: content.seo?.description?.[lang] || content.seo?.description?.en,
        }
      }
    }
  }));
}

const { lang } = Astro.params;
const { pageData } = Astro.props;

// Fallback if no page data
if (!pageData) {
  return Astro.redirect('/');
}

const title = pageData.seo?.title || pageData.title || 'Cinque Terre Dispatch | Luxury Travel Guide';
const description = pageData.seo?.description || '';
const body = pageData.body || [];
const locale = lang || 'en';
---

<Layout title={title} description={description} locale={locale}>
  <ContentRenderer blocks={body} locale={locale} />
  <Footer />
</Layout>
