---
/**
 * Cinque Terre Theme Content Renderer
 * Maps JSON blocks to theme components
 */
import Hero from './components/Hero.astro';
import Stats from './components/Stats.astro';
import Features from './components/Features.astro';
import VillageSelector from './components/VillageSelector.astro';
import PlacesToStay from './components/PlacesToStay.astro';
import VillageIntro from './components/VillageIntro.astro';
import Newsletter from './components/Newsletter.astro';
import SectionHeader from './components/SectionHeader.astro';
import TrendingNow from './components/TrendingNow.astro';
import About from './components/About.astro';
import CuratedEscapes from './components/CuratedEscapes.astro';
import LatestStories from './components/LatestStories.astro';
import ContentSection from './components/ContentSection.astro';
import FAQ from './components/FAQ.astro';
import CTA from './components/CTA.astro';

// Editorial components (Cinque Terre Theme)
import EditorialHero from './components/EditorialHero.astro';
import EditorialIntroBlock from './components/blocks/EditorialIntroBlock.astro';
import EditorialInterludeBlock from './components/blocks/EditorialInterludeBlock.astro';
import EditorNote from './components/EditorNote.astro';
import ClosingNoteBlock from './components/blocks/ClosingNoteBlock.astro';

// Template page blocks (Cinque Terre Theme)
import ItineraryHero from './components/blocks/ItineraryHero.astro';
import ItineraryDays from './components/blocks/ItineraryDays.astro';
import TeamGrid from './components/blocks/TeamGrid.astro';
import AirportsOverview from './components/blocks/AirportsOverview.astro';
import WeatherLive from './components/blocks/WeatherLive.astro';
import WeatherJournal from './components/blocks/WeatherJournal.astro';
import BlogArticle from './components/blocks/BlogArticle.astro';
import BlogIndex from './components/blocks/BlogIndex.astro';
import CollectionWithInterludes from './components/blocks/CollectionWithInterludes.astro';
import CollectionEmbed from './components/blocks/CollectionEmbed.astro';

// React components with client directives
import FeaturedCarousel from './components/FeaturedCarousel';
import EatDrink from './components/EatDrink';
import Highlights from './components/Highlights';
import AudioGuides from './components/AudioGuides';
import PracticalAdvice from './components/PracticalAdvice';

interface Block {
    type: string;
    [key: string]: unknown;
}

interface Props {
    blocks: Block[];
    locale?: string;
    village?: string; // Village context for village-specific pages
}

const { blocks = [], locale = 'en', village } = Astro.props;
---

{blocks.map((block: Block) => {
    const { type, ...props } = block;
    // Type assertion for component props - the JSON structure is validated at content level
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    const componentProps = props as any;

    switch (type) {
        case 'hero-section':
            return <Hero {...componentProps} locale={locale} village={village} />;

        case 'stats-section':
            return <Stats {...componentProps} locale={locale} village={village} />;

        case 'feature-section':
            return <Features {...componentProps} locale={locale} village={village} />;

        case 'village-selector':
            // Skip village-selector when viewing a specific village page
            if (village) return null;
            return <VillageSelector {...componentProps} locale={locale} />;

        case 'places-to-stay':
            return <PlacesToStay {...componentProps} locale={locale} village={village} />;

        case 'featured-carousel':
            return <FeaturedCarousel client:visible {...componentProps} locale={locale} village={village} />;

        case 'village-intro':
            return <VillageIntro {...componentProps} locale={locale} village={village} />;

        case 'newsletter':
            return <Newsletter {...componentProps} locale={locale} village={village} />;

        case 'section-header':
            return <SectionHeader {...componentProps} locale={locale} village={village} />;

        case 'trending-now':
            return <TrendingNow {...componentProps} locale={locale} village={village} />;

        case 'about':
            return <About {...componentProps} locale={locale} village={village} />;

        case 'curated-escapes':
            return <CuratedEscapes {...componentProps} locale={locale} village={village} />;

        case 'latest-stories':
            return <LatestStories {...componentProps} locale={locale} village={village} />;

        case 'eat-drink':
            return <EatDrink client:visible {...componentProps} locale={locale} village={village} />;

        case 'highlights':
            return <Highlights client:visible {...componentProps} locale={locale} village={village} />;

        case 'audio-guides':
            return <AudioGuides client:visible {...componentProps} locale={locale} village={village} />;

        case 'practical-advice':
            return <PracticalAdvice client:visible {...componentProps} locale={locale} village={village} />;

        case 'content-section':
            return <ContentSection {...componentProps} locale={locale} />;

        case 'faq-section':
            return <FAQ {...componentProps} locale={locale} />;

        case 'cta-section':
            return <CTA {...componentProps} locale={locale} />;

        // Editorial blocks (Cinque Terre Theme)
        case 'editorial-hero':
            return <EditorialHero {...componentProps} locale={locale} />;

        case 'editorial-intro':
            return <EditorialIntroBlock {...componentProps} locale={locale} />;

        case 'editorial-interlude':
            return <EditorialInterludeBlock {...componentProps} locale={locale} />;

        case 'editor-note':
            return <EditorNote {...componentProps} locale={locale} />;

        case 'closing-note':
            return <ClosingNoteBlock {...componentProps} locale={locale} />;

        // Template page blocks (Cinque Terre Theme)
        case 'itinerary-hero':
            return <ItineraryHero {...componentProps} />;

        case 'itinerary-days':
            return <ItineraryDays {...componentProps} locale={locale} />;

        case 'team-grid':
            return <TeamGrid {...componentProps} />;

        case 'airports-overview':
            return <AirportsOverview {...componentProps} />;

        case 'weather-live': {
            // Map JSON structure to component props
            const weather = componentProps.currentWeather || componentProps.current;
            const weatherProps = {
                current: weather ? {
                    temp: weather.temp,
                    condition: typeof weather.condition === 'object' ? weather.condition[locale] || weather.condition.en : weather.condition,
                    icon: weather.icon,
                    high: weather.high,
                    low: weather.low,
                    wind: weather.wind,
                    humidity: weather.humidity,
                    seaTemp: weather.seaTemp,
                    uvIndex: typeof weather.uvIndex === 'object' ? weather.uvIndex[locale] || weather.uvIndex.en : weather.uvIndex,
                    visibility: weather.visibility,
                    sunrise: weather.sunrise,
                    sunset: weather.sunset,
                } : undefined,
                forecast: (componentProps.forecast || []).map((day: any) => ({
                    day: typeof day.day === 'object' ? day.day[locale] || day.day.en : day.day,
                    date: typeof day.date === 'object' ? day.date[locale] || day.date.en : day.date,
                    high: day.high,
                    low: day.low,
                    condition: typeof day.condition === 'object' ? day.condition[locale] || day.condition.en : day.condition,
                    icon: day.icon,
                })),
                webcams: componentProps.webcams,
                heroImage: componentProps.image,
                title: typeof componentProps.title === 'object' ? componentProps.title[locale] || componentProps.title.en : componentProps.title,
                subtitle: typeof componentProps.subtitle === 'object' ? componentProps.subtitle[locale] || componentProps.subtitle.en : componentProps.subtitle,
            };
            return <WeatherLive {...weatherProps} />;
        }

        case 'weather-journal':
            return <WeatherJournal {...componentProps} />;

        case 'blog-article':
            return <BlogArticle {...componentProps} />;

        case 'blog-index':
            return <BlogIndex {...componentProps} locale={locale} />;

        case 'collection-with-interludes':
            return <CollectionWithInterludes {...componentProps} locale={locale} />;

        case 'collection-embed':
            return <CollectionEmbed {...componentProps} locale={locale} />;

        default:
            // Log unknown block type for debugging
            console.warn(`Unknown block type: ${type}`);
            return (
                <div class="py-8 px-4 bg-yellow-50 border border-yellow-200 rounded-lg my-4 container mx-auto">
                    <p class="text-yellow-800 text-sm">
                        Unknown block type: <code class="font-mono bg-yellow-100 px-1 rounded">{type}</code>
                    </p>
                    <pre class="mt-2 text-xs text-yellow-700 overflow-auto max-h-40">
                        {JSON.stringify(componentProps, null, 2)}
                    </pre>
                </div>
            );
    }
})}
