---
import Layout from '../../layouts/Layout.astro'
import TenantForm from '../../components/TenantForm'
import { Card, CardDescription, CardHeader, CardTitle } from '../../components/ui/card'
import { trpc, handleTRPCError } from '../../lib/trpc'

const { id } = Astro.params

if (!id) {
  return Astro.redirect('/tenants')
}

// Fetch tenant server-side
let tenant: any = null
let error: string | null = null

try {
  tenant = await trpc.company.getById.query({ id })
} catch (e) {
  error = handleTRPCError(e)
  console.error('Failed to fetch tenant:', error)
}
---

<Layout title={tenant ? `Edit ${tenant.name}` : 'Edit Media House'}>
  <div>
    <div class="mb-8">
      <a href="/tenants" class="text-muted-foreground hover:text-foreground transition">
        ‚Üê Back to Media Houses
      </a>
    </div>

    {error ? (
      <Card className="border-destructive">
        <CardHeader>
          <CardTitle className="text-destructive">Error Loading Media House</CardTitle>
          <CardDescription>{error}</CardDescription>
        </CardHeader>
      </Card>
    ) : tenant ? (
      <TenantForm client:load mode="edit" tenant={tenant} />
    ) : (
      <Card>
        <CardHeader>
          <CardTitle>Media House Not Found</CardTitle>
          <CardDescription>
            The requested media house could not be found.
          </CardDescription>
        </CardHeader>
      </Card>
    )}
  </div>
</Layout>
