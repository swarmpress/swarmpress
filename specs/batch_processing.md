# Briefing: Batch-Based Agentic Content Pipeline for **CinqueTerre.Travel**

## Objective
Design a scalable, cost‑efficient, and high‑quality content generation pipeline for **cinqueterre.travel** using:
- **Claude Message Batches API**
- **Claude Agents with web_search & web_fetch tools**
- **Structured schemas for all content collections (POIs, accommodations, events, etc.)**
- **A multi-agent editorial workflow** (Research → Writing → Translation → SEO)

This document outlines *why* and *how* to use batch processing and tool-enabled agents to build the site’s content at scale.

---

## 1. Why Use Message Batches?

Claude’s **Message Batches API** is ideal for CinqueTerre.Travel because:
- Your tasks are **high-volume**, **repeatable**, and **schema-driven**.
- Any single item (POI, hotel, event…) requires **the same pipeline**.
- No need for realtime responses → asynchronous batch execution is perfect.
- Batch pricing provides **~50% discount** on input/output tokens.
- **Tool use is fully supported inside batches** (web_search & web_fetch).
- Prompt caching can be combined with batch pricing for additional savings.

---

## 2. Collections & Workflows

For each village (e.g. Riomaggiore, Manarola, Vernazza, Corniglia, Monterosso), you maintain collections such as:

- POIs (Top 20)
- Accommodations (Top 20)
- Restaurants (Top 20)
- Hikes & Trails
- Events (seasonal, updated more often)

Each collection follows a **strict schema**. Example:

```json
{
  "id": "string",
  "name": "string",
  "description_raw": "string",
  "location": { "lat": 0, "lng": 0 },
  "attributes": {},
  "sources": []
}
```

The entire production flow is powered by four agents.

---

## 3. The Agents

### **3.1 Research Agent (Tools Enabled)**
Purpose: Generate **source-grounded, accurate, up-to-date** top 20 lists per village & category.

Tools used:
- **web_search** → discover relevant web pages
- **web_fetch** → extract structured information from pages found in search

Output:
- 20 high-confidence items per collection
- Grounded details (opening hours, highlights, history, coordinates, etc.)
- Source citations

Executed using **Message Batches** with one request per (village × collection).

---

### **3.2 Writer Agent (Tools Optional)**
Purpose: Rewrite raw entries into emotionally rich editorial content using a fixed persona.

Input:
- Raw research JSON

Output:
- Styled prose (for teasers, descriptions, storytelling sections)
- JSON-structured content

Runs as a **batch** for all items generated by the research agent.

Tools:
- Usually **disabled** (no need; content is already sourced).

---

### **3.3 Translator Agent**
Purpose: Translate the structured editorial text into multiple languages (IT, EN, DE, FR…).

Runs as:
- One batch containing thousands of translation tasks.
- Extremely efficient with prompt caching.

Tools:
- Disabled (no live data needed).

---

### **3.4 SEO Agent (Tools Optional)**
Purpose:
- Generate SEO metadata (titles, meta descriptions, slugs)
- Produce semantic keywords
- Suggest cross-linking between pages
- Optionally refresh content based on **live search trends** using web_search & web_fetch

Runs as:
- Either part of a unified “content-production agent”
- Or separate occasional SEO update batches

Tools:
- **Enabled only when fresh SEO signals are needed**

---

## 4. Recommended Pipeline (Production)

### **Step 1 — Research Batch**
- Tools enabled  
- Message Batch request per (village × collection)  
- Output: Raw top‑20 items

### **Step 2 — Content Production Batch**
A combined agent handling:
- Writing
- Multi-language translation
- SEO metadata generation

→ All in **one single batched call per item** to reduce tokens.

### **Step 3 — Import into Astro + TinaCMS**
- Write results into file-based content structures
- Auto-generate slugs, routes, collections

### **Step 4 — Optional Quarterly SEO Refresh**
- Lightweight batch with tools enabled to stay aligned with search trends.

---

## 5. Benefits

### **Cost Efficiency**
- 50% token savings through batch pricing  
- Additional savings with prompt caching  
- Fewer model calls by merging roles into one “content production” step  

### **Quality & Accuracy**
- Web-grounded research using live sources  
- SEO optimized with optional tool-based freshness  
- Consistent editorial tone through controlled personas  

### **Scalability**
- You can regenerate entire content sets (ALL villages & collections) in a few batch jobs.
- Supports future expansions (Liguria, Tuscany, Amalfi Coast, etc.)

---

## 6. Example: Batch Request Structure (Simplified)

```json
{
  "requests": [
    {
      "custom_id": "research_poi_manarola",
      "params": {
        "model": "claude-3-5-sonnet",
        "system": "You are the research agent...",
        "messages": [
          { "role": "user", "content": "Generate top 20 POIs for Manarola..." }
        ],
        "tools": [
          { "type": "web_search", "name": "web_search" },
          { "type": "web_fetch", "name": "web_fetch" }
        ]
      }
    }
  ],
  "endpoint": "/v1/messages"
}
```

---

## 7. Summary

The CinqueTerre.Travel editorial system becomes:

### **Fast**
Thousands of items generated in one pass.

### **Cheap**
Batch pricing + caching = massive token savings.

### **High Quality**
Web-grounded, multi‑agent, multi‑language content production.

### **Future-Proof**
Fully automated regeneration and SEO-refresh cycles ensure the website stays relevant for years.

---

## 8. Next Steps

1. Define final JSON schemas per collection  
2. Define personas for writer agents  
3. Create a tool-allowlist (trusted domains)  
4. Implement a batch orchestrator service (Node or Python)  
5. Run a test batch for **Manarola POIs** end‑to‑end  

---

If you want, I can now produce:
✔ A ready‑to‑use Batch Orchestrator script  
✔ A folder structure for Astro + TinaCMS  
✔ Real examples for POIs, hotels, and restaurants  
✔ Automation flows for refreshing content  

